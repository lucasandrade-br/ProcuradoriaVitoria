{% extends 'gestao/base.html' %}

{% block content %}
    <h1>Monitoramento de Análises</h1>
    <p class="text-muted">Lista de todos os documentos distribuídos que ainda não foram finalizados.</p>
    <hr>

    <table class="table table-striped table-hover table-sm align-middle">
        <thead>
            <tr class="table-dark">
                <th class="text-center">Prazo Limite</th>
                <th class="text-center">N° Documento</th> 
                <th class="text-center">Protocolo</th>
                <th class="text-center">Status</th>
                <th class="text-center">Tipo de Documento</th>
                <th class="text-center">Prioridade</th> 
                <th class="text-center">Procurador</th> 
                <th class="text-center">Interessados</th>
                <th class="text-center">Ações</th> 
            </tr>
        </thead>
        <tbody>
            {% for doc in documentos %}
            <tr>
                <td class="text-center text-danger fw-bold">{{ doc.data_limite|date:"d/m/Y"|default:"-" }}</td>
                <td class="text-center">{{ doc.num_doc_origem }}</td>
                <td class="text-center">{{ doc.protocolo }}</td>
                
                <td class="text-center">
                    {% if doc.status == 'Análise Concluída' %}
                        <span class="badge rounded-pill bg-success-subtle text-success-emphasis">
                            {{ doc.status }}
                        </span>
                    {% elif doc.status == 'Rejeitado' %}
                        <span class="badge rounded-pill bg-danger-subtle text-danger-emphasis">
                            {{ doc.status }}
                        </span>
                    {% else %}
                        <span class="badge rounded-pill bg-info-subtle text-info-emphasis">
                            {{ doc.status }}
                        </span>
                    {% endif %}
                </td>
                
                <td class="text-center">{{ doc.tipo_documento }}</td>
                <td class="text-center">{{ doc.prioridade }}</td>
                <td class="text-start">{{ doc.procurador_atribuido.get_full_name|default:doc.procurador_atribuido.username }}</td>
                <td class="text-start">
                    <div class="d-flex flex-wrap gap-1">
                        {% for interessado in doc.interessados.all %}
                            <span class="badge bg-primary-subtle text-primary-emphasis border border-primary-subtle px-2 py-1" 
                                style="font-size: 0.75rem;" 
                                title="{{ interessado.nome_razao_social }}">
                                <i class="fas fa-university me-1"></i>{{ interessado.nome_razao_social|truncatechars:25 }}
                            </span>
                        {% empty %}
                            <span class="text-muted small italic">Nenhum interessado</span>
                        {% endfor %}
                    </div>
                </td>
                
                <td class="text-center"> 
                    <a href="{% url 'gestao:finalizacao_detail' pk=doc.pk %}" title="Acessar Processo" 
                       class="text-decoration-none me-2" style="color: #04357b; font-size: 1.1em;">
                       <i class="fas fa-eye"></i>
                    </a> 

                    {% if doc.status == 'Em Análise' and doc.procurador_atribuido %}
                        <a href="{% url 'gestao:enviar_lembrete' pk=doc.pk %}" title="Enviar Lembrete" 
                           class="text-decoration-none" style="color: #04357b; font-size: 1.1em;">
                           <i class="fas fa-paper-plane"></i>
                        </a>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9" class="text-center p-3">
                    Nenhum documento em análise ou aguardando finalização no momento.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

{% endblock %}